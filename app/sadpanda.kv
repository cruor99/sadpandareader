#:import win kivy.core.window
#:import Toolbar kivymd.toolbar.Toolbar
#:import SingleLineTextField kivymd.textfields.SingleLineTextField
#:import MDSwitch kivymd.selectioncontrols.MDSwitch
#:import MDList kivymd.list.MDList

<ThumbButton>:
    font_name: "fonts/NotoSansCJK-Regular.ttc"
    _num_lines: 3
    primary_font_style: "Body1"
    secondary_size_hint_y: 1

<WrappedLabel@Label>:
    font_name: "fonts/NotoSansCJK-Regular.ttc"
    size_hint_y: None
    height: self.texture_size[1] + (self.texture_size[1]/2)
    markup: True
    text_size: self.width, None


<SadpandaRoot>:
    orientation: "vertical"
    ScreenManager:
        id: sadpanda_screen_manager
        StartScreen:
            id: start_screen
            name: "start_screen"
        FrontScreen:
            id: front_screen
            name: "front_screen"
        GalleryScreen:
            id: gallery_screen
            name: "gallery_screen"
        GalleryPreviewScreen:
            id: gallery_preview_screen
            name: "gallery_preview_screen"


<StartScreen>:
    RelativeLayout:
        canvas.before:
            Rectangle:
                pos: self.pos
                size: self.size
                source: "img/main_bg.png"
        BoxLayout:
            center: self.parent.center
            pos_hint: {"center_x": 0.4, "center_y": 0.5}
            size_hint: None, None
            orientation: "vertical"
            SingleLineTextField:
                size_hint: None, None
                height: "48dp"
                width: "150dp"
                id: username
                hint_text: "Username"
                _hint_txt_color: (0, 0, 0, 1)
            SingleLineTextField:
                id: password
                password: True
                size_hint: None, None
                height: "48dp"
                width: "150dp"
                hint_text: "Password"
                _hint_txt_color: (0, 0, 0, 1)
            MDRaisedButton:
                size_hint_y: None
                size_hint_x: None
                id: login
                height: "60dp"
                width: "150dp"
                text: "login"
                on_release: app.root.login_exhentai(username, password)


<CaptchaPopup>:
    size_hint: .8, None
    height: dp(200)
    title: "Login Failed"
    MDLabel:
        text: "You can either try again or continue to non-restricted content."


<FrontScreen>:
    BoxLayout:
        orientation: "vertical"
        Toolbar:
            id: toolbar
            title: root.title
            left_action_items: [["menu", lambda x: app.nav_drawer.toggle(), False]]
        FloatLayout:
            ScrollView:
                id: galleryscroll
                MDList:
                    id: main_layout
                    size_hint_x: 1
            MDFloatingActionButton:
                size_hint_y: None
                icon: "search"
                size_hint: None, None
                size: dp(56), dp(56)
                opposite_colors: True
                # background_color: (0, 1, 0, 1)
                elevation_normal: 8
                pos_hint: {"center_x": 0.9, "center_y": 0.1}
                on_release: app.root.search_popup()

<TagButton>:
    size_hint_y: None
    height: "55dp"
    # background_color: (.7, .7, .7, 0.5)
    text: root.tagname
    #text_size: self.width, None
    halign: "center"

<GalleryPreviewScreen>:
    BoxLayout:
        orientation: "vertical"
        Toolbar:
            id: toolbar
            title: root.title
            left_action_items: [["menu", lambda x: app.nav_drawer.toggle(), False]]
        AsyncImage:
            source: root.gallery_thumb
            allow_stretch: True
            size_hint_y: None
            height: dp(200)
        BoxLayout:
            orientation: "horizontal"
            size_hint_y: .3
            MDFlatButton:
                text: "Start Reading"
                font_name: "fonts/NotoSansCJK-Regular.ttc"
                height: dp(40)
                size_hint_y: None
                size_hint_x: 1
                theme_text_color: "Primary"
                on_release: root.view_gallery()
            MDFlatButton:
                text: "Favourite"
                size_hint_y: None
                size_hint_x: 1
                theme_text_color: "Primary"
                height: dp(40)
                on_release: root.add_favourite()
        BoxLayout:
            orientation: "vertical"
            MDLabel:
                text: root.gallery_name
                valign: "top"
                halign: "center"
                font_style: "Title"
            GridLayout:
                cols: 2
                padding: dp(1)
                size_hint_y: None
                MDLabel:
                    text: "Pagecount: " +str(root.pagecount)
                    size_hint_y: None
                    valign: "middle"
                MDLabel:
                    text: "Filesize: " + str((root.filesize/1024)/1024) + " MB"
                    size_hint_y: None
                    valign: "middle"
            ScrollView:
                height: self.parent.height
                width: self.parent.width-20
                bar_inactive_color: [.7, .7, .7, .5]
                GridLayout:
                    id: tag_layout
                    cols: 3
                    height: self.minimum_height
                    size_hint_y: None



<GalleryImage>:
    size: root.width, root.height
    nocache: True

<GalleryCarousel>:
    loop: True
    on__offset: self.startmove()

<GalleryScreen>:
    BoxLayout:
        orientation: "vertical"
        Toolbar:
            id: toolbar
            title: root.title
            left_action_items: [["menu", lambda x: app.nav_drawer.toggle(), False]]
        ScreenManager:
            id: gallery_manager

<GalleryNavButton>:
    background_color: 0, 0, 0, .2
    background_normal: "img/transparent.png"
    background_down: "img/button_bg_down.png"
    size_hint_x: None
    width: dp(70)




<FilterPopup>:
    title: "Set your filters here"
    size_hint: .8, None
    height: dp(500)
    BoxLayout:
        orientation: "vertical"
        GridLayout:
            cols: 2
            padding: dp(40), dp(1)
            spacing: dp(15)
            BoxLayout:
                orientation: "vertical"
                MDLabel:
                    text: "Non-H"
                MDSwitch:
                    id: nonh
                    size_hint: None, None
                    size: dp(36), dp(48)
                    text: "Non-H"
            BoxLayout:
                orientation: "vertical"
                MDLabel:
                    text: "Doujinshi"
                MDSwitch:
                    id: doujinshi
                    text: "Doujinshi"
                    size_hint: None, None
                    size: dp(36), dp(48)
            BoxLayout:
                orientation: "vertical"
                MDLabel:
                    text: "Western"
                MDSwitch:
                    id: western
                    text: "Western"
                    size_hint: None, None
                    size: dp(36), dp(48)
            BoxLayout:
                orientation: "vertical"
                MDLabel:
                    text: "Artist CG"
                MDSwitch:
                    id: artistcg
                    text: "Artist CG"
                    size_hint: None, None
                    size: dp(36), dp(48)
            BoxLayout:
                orientation: "vertical"
                MDLabel:
                    text: "Game CG"
                MDSwitch:
                    id: gamecg
                    text: "Game CG"
                    size_hint: None, None
                    size: dp(36), dp(48)
            BoxLayout:
                orientation: "vertical"
                MDLabel:
                    text: "Manga"
                MDSwitch:
                    id: manga
                    text: "Manga"
                    size_hint: None, None
                    size: dp(36), dp(48)
            BoxLayout:
                orientation: "vertical"
                MDLabel:
                    text: "Cosplay"
                MDSwitch:
                    id: cosplay
                    text: "Cosplay"
                    size_hint: None, None
                    size: dp(36), dp(48)
            BoxLayout:
                orientation: "vertical"
                MDLabel:
                    text: "Asian Porn"
                MDSwitch:
                    id: asianporn
                    text: "Asian Porn"
                    size_hint: None, None
                    size: dp(36), dp(48)
            BoxLayout:
                orientation: "vertical"
                MDLabel:
                    text: "Image Set"
                MDSwitch:
                    id: imageset
                    text: "Image Set"
                    size_hint: None, None
                    size: dp(36), dp(48)
            BoxLayout:
                orientation: "vertical"
                MDLabel:
                    text: "Misc"
                MDSwitch:
                    id: misc
                    text: "Misc"
                    size_hint: None, None
                    size: dp(36), dp(48)
        MDRaisedButton:
            text: "Set Filters"
            size_hint_y: None
            height: dp(64)
            on_release: root.dismiss()


<SearchPopup>:
    title: "Search"
    id: searchpopup
    size_hint: .8, None
    height: dp(200)
    SearchArea:
        id: searcharea
        on_text_validate: root.savesearch()

<SearchArea>:
    size_hint: 1, None
    height: "48dp"
    hint_text: "Terms and tags"
    foreground_color: (1, 1, 1, .5)

<SadpandaNavdrawer>:
    NavigationDrawerIconButton:
        icon: "home"
        text: "Frontpage"
        on_release: app.root.goto_front()
    NavigationDrawerIconButton:
        icon: "search"
        text: "Search"
        on_release: app.root.search_popup()
    NavigationDrawerIconButton:
        icon: "star"
        text: "Favourites (COMING SOON)"
