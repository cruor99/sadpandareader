#:import win kivy.core.window
SadpandaRoot:

<ThumbButton>:
    size_hint_y: None
    size_hint_x: None
    height: "200dp"
    width: "200dp"
    keep_aspect: True
    allow_stretch: True


<GalleryTitle>:
    size_hint_y: 1
    Label:
        font_name: "fonts/NotoSansCJK-Regular.ttc"
        text: root.titletext
        font_size: "15dp"
        max_lines: 6
        text_size: self.width, self.height
        valign: "top"

<WrappedLabel@Label>:
    font_name: "fonts/NotoSansCJK-Regular.ttc"
    size_hint_y: None
    height: self.texture_size[1] + (self.texture_size[1]/2)
    markup: True
    text_size: self.width, None


<SadpandaRoot>:
    orientation: "vertical"
    ActionBar:
        ActionView:
            ActionPrevious:
                title: ""
                with_previous: False
                app_icon: "img/icon_round.png"
                previous_image: "img/back_image.png"
                with_previous: True
                on_release: app.root.onBackBtn()
            ActionButton:
                text: "To Front"
                on_press: app.root.goto_front()
            ActionButton:
                text: "Search"
                on_press: app.root.search_popup()

    ScreenManager:
        id: sadpanda_screen_manager
        StartScreen:
            id: start_screen
            name: "start_screen"
        FrontScreen:
            id: front_screen
            name: "front_screen"
        GalleryScreen:
            id: gallery_screen
            name: "gallery_screen"
        GalleryPreviewScreen
            id: gallery_preview_screen
            name: "gallery_preview_screen"


<StartScreen>:
    RelativeLayout:
        canvas.before:
            Rectangle:
                pos: self.pos
                size: self.size
                source: "img/sadpanda.jpg"
        BoxLayout:
            center: self.parent.center
            pos_hint: {"center_x": 0.8, "center_y": 0.9}
            orientation: "vertical"
            TextInput:
                multiline: False
                size_hint: None, None
                height: "40dp"
                width: "150dp"
                id: username
                hint_text: "Username"
                background_color: [1, 1, 1, .5]
            TextInput:
                multiline: False
                size_hint: None, None
                id: password
                password: True
                height: "40dp"
                width: "150dp"
                hint_text: "Password"
                background_color: [1, 1, 1, .5]
            Button:
                size_hint_y: None
                size_hint_x: None
                id: login
                height: "60dp"
                width: "150dp"
                text: "login"
                on_release: app.root.login_exhentai(username, password)


<CaptchaPopup>:
    BoxLayout:
        orientation: "vertical"
        Label:
            text: "Login failed."

        Button:
            text: "Try again"
            id: try_again
            on_release: root.try_again()
        Button:
            text: "View Non-restricted content"
            on_release: root.non_restricted()






<FrontScreen>:
    BoxLayout:
        orientation: "vertical"
        ScrollView:
            #size:  self.size
            #height: self.parent.height
            #width: self.parent.width-20
            GridLayout:
                id: main_layout
                cols: 1
                padding: root.width * .02, root.height * .02
                spacing: "10dp"
                height: self.minimum_height
                size_hint_y: None
                row_default_height: '200dp'
        Button:
            size_hint_y: None
            height: "60dp"
            text: "Load More"
            on_release: root.populate_front()

<TagButton>:
    size_hint_y: None
    height: "55dp"
    background_color: (.7, .7, .7, 0.5)
    text: root.tagname
    text_size: self.width, None
    halign: "center"

<GalleryPreviewScreen>:
    BoxLayout:
        orientation: "vertical"
        AsyncImage:
            # This might not work with exhentai
            source: root.gallery_thumb
            size_hint_y: .7
        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            Button:
                text: "Start Reading"
                size_hint_y: None
                on_release: root.view_gallery()
            Button:
                text: "Add to favourites"
                size_hint_y: None
        BoxLayout:
            orientation: "vertical"
            WrappedLabel:
                size_hint_y: 1
                text: root.gallery_name
                valign: "top"
            ScrollView:
                height: self.parent.height
                width: self.parent.width-20
                bar_inactive_color: [.7, .7, .7, .5]
                GridLayout:
                    id: tag_layout
                    cols: 3
                    height: self.minimum_height
                    size_hint_y: None



<GalleryImage>:
    size: root.width, root.height

<GalleryScatter>:
    do_rotation: False
    scale_min: 1
    translation_touches: 2

<GalleryScreen>:
    BoxLayout:
        orientation: "vertical"
        WrappedLabel:
            text: root.gallery_name
        Carousel:
            id: gallery_carousel
            size_hint_y: 1.7
            direction: "right"
            min_move: 0.01
            scroll_timeout: 200
            on_index: root.load_next()

<FilterPopup>:
    title: "Set your filters here"
    BoxLayout:
        orientation: "vertical"
        GridLayout:
            cols: 5
            rows: 2
            ToggleButton:
                id: nonh
                text: "Non-H"
            ToggleButton:
                id: doujinshi
                text: "Doujinshi"
            ToggleButton:
                id: western
                text: "Western"
            ToggleButton:
                id: artistcg
                text: "Artist CG"
            ToggleButton:
                id: gamecg
                text: "Game CG"
            ToggleButton:
                id: manga
                text: "Manga"
            ToggleButton:
                id: cosplay
                text: "Cosplay"
            ToggleButton:
                id: asianporn
                text: "Asian Porn"
            ToggleButton:
                id: imageset
                text: "Image Set"
            ToggleButton:
                id: misc
                text: "Misc"
        Button:
            text: "Set Filters"
            on_release: root.dismiss()


<SearchPopup>:
    title: "Input Search Here"
    BoxLayout:
        orientation: "vertical"
        padding: root.width * .2, root.height * .2
        spacing: min(root.width, root.height) * .02
        WrappedLabel:
            text: "Search for your sadpanda here"
        TextInput:
            id: searchstring
            size_hint_y: None
            multiline: False
            on_text_validate: root.savesearch()
        Button:
            text: "Start Searching"
            on_release: root.savesearch()
        Button:
            text: "Filters"
            on_release: root.open_filters()
